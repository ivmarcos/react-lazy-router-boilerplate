{"version":3,"sources":["../../../src/intrinsics/ecma262/FunctionPrototype.js"],"names":["realm","obj","$Call","thisArgument","argsList","intrinsics","undefined","defineNativeProperty","zero","writable","emptyString","defineNativeMethod","func","thisArg","argList","createErrorThrowCompletion","TypeError","argArray","context","args","Target","F","targetHasLength","L","targetLen","mightBeNumber","throwIfNotConcreteNumber","Math","max","length","value","enumerable","configurable","targetName","SymbolHasInstance","V","throwIfNotConcrete","name"],"mappings":"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","file":"FunctionPrototype.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\n\nimport type { Realm } from \"../../realm.js\";\nimport { BoundFunctionCreate, SetFunctionName } from \"../../methods/function.js\";\nimport { DefinePropertyOrThrow } from \"../../methods/properties.js\";\nimport { BooleanValue, NullValue, UndefinedValue, NumberValue, StringValue, FunctionValue, NativeFunctionValue, ObjectValue } from \"../../values/index.js\";\nimport { Call } from \"../../methods/call.js\";\nimport { ToInteger } from \"../../methods/to.js\";\nimport { CreateListFromArrayLike } from \"../../methods/create.js\";\nimport { Get } from \"../../methods/get.js\";\nimport { IsCallable } from \"../../methods/is.js\";\nimport { HasOwnProperty, HasSomeCompatibleType } from \"../../methods/has.js\";\nimport { OrdinaryHasInstance } from \"../../methods/abstract.js\";\nimport { ThrowCompletion } from \"../../completions.js\";\nimport invariant from \"../../invariant.js\";\n\nexport default function (realm: Realm, obj: ObjectValue): void {\n  // ECMA262 19.2.3\n  obj.$Call = (thisArgument, argsList) => {\n    return realm.intrinsics.undefined;\n  };\n\n  // ECMA262 19.2.3\n  obj.defineNativeProperty(\"length\", realm.intrinsics.zero, { writable: false });\n\n  // ECMA262 19.2.3\n  obj.defineNativeProperty(\"name\", realm.intrinsics.emptyString, { writable: false });\n\n  // ECMA262 19.2.3.3\n  obj.defineNativeMethod(\"call\", 1, (func, [thisArg, ...argList]) => {\n    // 1. If IsCallable(func) is false, throw a TypeError exception.\n    if (IsCallable(realm, func) === false) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"not callable\");\n    }\n\n    // 2. Let argList be a new empty List.\n    // 3. If this method was called with more than one argument, then in left to right order,\n    //    starting with the second argument, append each argument as the last element of argList.\n    argList;\n\n    // TODO 4. Perform PrepareForTailCall().\n\n    // 5. Return ? Call(func, thisArg, argList).\n    return Call(realm, func, thisArg, argList);\n  });\n\n  // ECMA262 19.2.3.1\n  obj.defineNativeMethod(\"apply\", 2, (func, [thisArg, argArray]) => {\n    // 1. If IsCallable(func) is false, throw a TypeError exception.\n    if (IsCallable(realm, func) === false) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError,\n        \"not callable\");\n    }\n\n    // 2. If argArray is null or undefined, then\n    if (HasSomeCompatibleType(realm, argArray, NullValue, UndefinedValue)) {\n      // TODO a. Perform PrepareForTailCall().\n\n      // b. Return ? Call(func, thisArg).\n      return Call(realm, func, thisArg);\n    }\n\n    // 3. Let argList be ? CreateListFromArrayLike(argArray).\n    let argList = CreateListFromArrayLike(realm, argArray);\n\n    // TODO 4. Perform PrepareForTailCall().\n\n    // 5. Return ? Call(func, thisArg, argList).\n    return Call(realm, func, thisArg, argList);\n  });\n\n  // ECMA262 19.2.3.2\n  obj.defineNativeMethod(\"bind\", 1, (context, [thisArg, ...args]) => {\n    // 1. Let Target be the realm value.\n    let Target = context;\n\n    // 2. If IsCallable(Target) is false, throw a TypeError exception.\n    if (IsCallable(realm, Target) === false) {\n      throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n    }\n    invariant(Target instanceof ObjectValue);\n\n    // 3. Let args be a new (possibly empty) List consisting of all of the argument values provided after thisArg in order.\n    args;\n\n    // 4. Let F be ? BoundFunctionCreate(Target, thisArg, args).\n    let F = BoundFunctionCreate(realm, Target, thisArg, args);\n\n    // 5. Let targetHasLength be ? HasOwnProperty(Target, \"length\").\n    let targetHasLength = HasOwnProperty(realm, Target, new StringValue(realm, \"length\"));\n\n    let L;\n\n    // 6. If targetHasLength is true, then\n    if (targetHasLength === true) {\n      // a. Let targetLen be ? Get(Target, \"length\").\n      let targetLen = Get(realm, Target, new StringValue(realm, \"length\"));\n\n      // b. If Type(targetLen) is not Number, let L be 0.\n      if (!targetLen.mightBeNumber()) {\n        L = 0;\n      } else { // c. Else,\n        targetLen = targetLen.throwIfNotConcreteNumber();\n        // i. Let targetLen be ToInteger(targetLen).\n        targetLen = ToInteger(realm, targetLen);\n\n        // ii. Let L be the larger of 0 and the result of targetLen minus the number of elements of args.\n        L = Math.max(0, targetLen - args.length);\n      }\n    } else { // 7. Else let L be 0.\n      L = 0;\n    }\n\n    // 8. Perform ! DefinePropertyOrThrow(F, \"length\", PropertyDescriptor {[[Value]]: L, [[Writable]]: false, [[Enumerable]]: false, [[Configurable]]: true}).\n    DefinePropertyOrThrow(realm, F, \"length\", {\n      value: new NumberValue(realm, L),\n      writable: false,\n      enumerable: false,\n      configurable: true\n    });\n\n    // 9. Let targetName be ? Get(Target, \"name\").\n    let targetName = Get(realm, Target, new StringValue(realm, \"name\"));\n\n    // 10. If Type(targetName) is not String, let targetName be the empty string.\n    if (!(targetName instanceof StringValue)) targetName = realm.intrinsics.emptyString;\n\n    // 11. Perform SetFunctionName(F, targetName, \"bound\").\n    SetFunctionName(realm, F, targetName, \"bound\");\n\n    // 12. Return F.\n    return F;\n  });\n\n  // 19.2.3.6\n  obj.defineNativeMethod(realm.intrinsics.SymbolHasInstance, 1, (context, [V]) => {\n    // 1. Let F be the this value.\n    let F = context;\n\n    // 2. Return ? OrdinaryHasInstance(F, V).\n    return new BooleanValue(realm, OrdinaryHasInstance(realm, F, V));\n  }, { writable: false, configurable: false });\n\n  obj.defineNativeMethod(\"toString\", 0, (context) => {\n    context = context.throwIfNotConcrete();\n    if (context instanceof NativeFunctionValue) {\n      return new StringValue(realm, `function ${context.name}() { [native code] }`);\n    } else if (context instanceof FunctionValue) {\n      return new StringValue(realm, \"function () { TODO: provide function source code }\");\n    } else {\n      // Can I use realm.createErrorThrowCompletion here? what `type` error is this?\n      throw new ThrowCompletion(new StringValue(realm, \"Function.prototype.toString is not generic\"));\n    }\n  });\n}\n"]}