{"version":3,"sources":["../../../src/intrinsics/dom/global.js"],"names":["realm","global","$GlobalObject","$DefineOwnProperty","value","writable","enumerable","configurable","context","args","callback","throwIfNotConcrete","createErrorThrowCompletion","intrinsics","TypeError","isPartial","Error","generator","undefined","emitCallAndCaptureResult","topVal","preludeGenerator","memoizeReference","emitCall"],"mappings":"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","file":"global.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../../realm.js\";\n\nimport { FunctionValue, NativeFunctionValue } from \"../../values/index.js\";\nimport initializeDocument from \"./document.js\";\nimport initializeConsole from \"../common/console.js\";\nimport invariant from \"../../invariant.js\";\nimport { TypesDomain, ValuesDomain } from \"../../domains/index.js\";\n\nexport default function (realm: Realm): void {\n  let global = realm.$GlobalObject;\n\n  global.$DefineOwnProperty(\"console\", {\n    value: initializeConsole(realm),\n    writable: true,\n    enumerable: false,\n    configurable: true\n  });\n\n  global.$DefineOwnProperty(\"self\", {\n    value: global,\n    writable: true,\n    enumerable: true,\n    configurable: true\n  });\n\n  global.$DefineOwnProperty(\"window\", {\n    value: global,\n    writable: true,\n    enumerable: true,\n    configurable: true\n  });\n\n  global.$DefineOwnProperty(\"document\", {\n    value: initializeDocument(realm),\n    writable: true,\n    enumerable: false,\n    configurable: true\n  });\n\n  global.$DefineOwnProperty(\"setTimeout\", {\n    value: new NativeFunctionValue(realm, \"::global.setTimeout\", \"\", 2, (context, args) => {\n      let callback = args[0].throwIfNotConcrete();\n      if (!(callback instanceof FunctionValue))\n        throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"callback arguments must be function\");\n      if (!realm.isPartial) throw new Error(\"TODO: implement global.setTimeout\");\n      invariant(realm.generator !== undefined);\n      let generator = realm.generator;\n      return generator.emitCallAndCaptureResult(\n        TypesDomain.topVal, ValuesDomain.topVal,\n        () => generator.preludeGenerator.memoizeReference(\"::global.setTimeout\"), args);\n    }),\n    writable: true,\n    enumerable: true,\n    configurable: true\n  });\n\n  global.$DefineOwnProperty(\"clearTimeout\", {\n    value: new NativeFunctionValue(realm, \"::global.clearTimeout\", \"\", 2, (context, args) => {\n      if (!realm.isPartial) throw new Error(\"TODO: implement global.clearTimeout\");\n      invariant(realm.generator !== undefined);\n      let generator = realm.generator;\n      generator.emitCall(\n        () => generator.preludeGenerator.memoizeReference(\"::global.clearTimeout\"), args);\n      return realm.intrinsics.undefined;\n    }),\n    writable: true,\n    enumerable: true,\n    configurable: true\n  });\n\n  global.$DefineOwnProperty(\"setInterval\", {\n    value: new NativeFunctionValue(realm, \"::global.setInterval\", \"\", 2, (context, args) => {\n      if (!realm.isPartial) throw new Error(\"TODO: implement global.setInterval\");\n      let callback = args[0].throwIfNotConcrete();\n      if (!(callback instanceof FunctionValue))\n        throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError, \"callback arguments must be function\");\n      invariant(realm.generator !== undefined);\n      let generator = realm.generator;\n      return generator.emitCallAndCaptureResult(\n        TypesDomain.topVal, ValuesDomain.topVal,\n        () => generator.preludeGenerator.memoizeReference(\"::global.setInterval\"), args);\n    }),\n    writable: true,\n    enumerable: true,\n    configurable: true\n  });\n\n  global.$DefineOwnProperty(\"clearInterval\", {\n    value: new NativeFunctionValue(realm, \"::global.clearInterval\", \"\", 2, (context, args) => {\n      if (!realm.isPartial) throw new Error(\"TODO: implement global.clearInterval\");\n      invariant(realm.generator !== undefined);\n      let generator = realm.generator;\n      generator.emitCall(\n        () => generator.preludeGenerator.memoizeReference(\"::global.clearInterval\"), args);\n      return realm.intrinsics.undefined;\n    }),\n    writable: true,\n    enumerable: true,\n    configurable: true\n  });\n}\n"]}