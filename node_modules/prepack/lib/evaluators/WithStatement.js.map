{"version":3,"sources":["../../src/evaluators/WithStatement.js"],"names":["ast","strictCode","env","realm","val","evaluate","object","obj","oldEnv","newEnv","environmentRecord","withEnvironment","getRunningContext","lexicalEnvironment","C","evaluateCompletion","body","res","intrinsics","undefined"],"mappings":";;;;;;kBAqBe,UAAUA,GAAV,EAAuCC,UAAvC,EAA4DC,GAA5D,EAAqFC,KAArF,EAAsH;AACnI;AACA,MAAIC,MAAMF,IAAIG,QAAJ,CAAaL,IAAIM,MAAjB,EAAyBL,UAAzB,CAAV;;AAEA;AACA,MAAIM,MAAM,6BAAgBJ,KAAhB,EAAuB,sBAASA,KAAT,EAAgBC,GAAhB,CAAvB,CAAV;;AAEA;AACA,MAAII,SAASN,GAAb;;AAEA;AACA,MAAIO,SAAS,kCAAqBN,KAArB,EAA4BI,GAA5B,EAAiCC,MAAjC,CAAb;;AAEA;AACA,2BAAUC,OAAOC,iBAAP,gDAAV;AACAD,SAAOC,iBAAP,CAAyBC,eAAzB,GAA2C,IAA3C;;AAEA;AACAR,QAAMS,iBAAN,GAA0BC,kBAA1B,GAA+CJ,MAA/C;;AAEA,MAAI;AACF;AACA,QAAIK,IAAIL,OAAOM,kBAAP,CAA0Bf,IAAIgB,IAA9B,EAAoCf,UAApC,CAAR;AACA,6BAAUa,6BAAsBA,0CAAhC;;AAEA;AACA,QAAIG,MAAM,yBAAYd,KAAZ,EAAmBW,CAAnB,EAAsBX,MAAMe,UAAN,CAAiBC,SAAvC,CAAV;AACA,QAAIF,4CAAJ,EAAqC,MAAMA,GAAN;AACrC,6BAAUA,2BAAV;AACA,WAAOA,GAAP;AACD,GAVD,SAUU;AACR;AACAd,UAAMS,iBAAN,GAA0BC,kBAA1B,GAA+CL,MAA/C;AACD;AACF,C;;AA3CD;;AACA;;AACA;;AAEA;;AACA","file":"WithStatement.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport type { Realm } from \"../realm.js\";\nimport { LexicalEnvironment, ObjectEnvironmentRecord } from \"../environment.js\";\nimport { AbruptCompletion } from \"../completions.js\";\nimport { Value } from \"../values/index.js\";\nimport type { Reference } from \"../environment.js\";\nimport { ToObjectPartial, GetValue, NewObjectEnvironment, UpdateEmpty } from \"../methods/index.js\";\nimport invariant from \"../invariant.js\";\nimport type { BabelNodeWithStatement } from \"babel-types\";\n\n// ECMA262 13.11.7\nexport default function (ast: BabelNodeWithStatement, strictCode: boolean, env: LexicalEnvironment, realm: Realm): Value | Reference {\n  // 1. Let val be the result of evaluating Expression.\n  let val = env.evaluate(ast.object, strictCode);\n\n  // 2. Let obj be ? ToObject(? GetValue(val)).\n  let obj = ToObjectPartial(realm, GetValue(realm, val));\n\n  // 3. Let oldEnv be the running execution context's LexicalEnvironment.\n  let oldEnv = env;\n\n  // 4. Let newEnv be NewObjectEnvironment(obj, oldEnv).\n  let newEnv = NewObjectEnvironment(realm, obj, oldEnv);\n\n  // 5. Set the withEnvironment flag of newEnv's EnvironmentRecord to true.\n  invariant(newEnv.environmentRecord instanceof ObjectEnvironmentRecord);\n  newEnv.environmentRecord.withEnvironment = true;\n\n  // 6. Set the running execution context's LexicalEnvironment to newEnv.\n  realm.getRunningContext().lexicalEnvironment = newEnv;\n\n  try {\n    // 7. Let C be the result of evaluating Statement.\n    let C = newEnv.evaluateCompletion(ast.body, strictCode);\n    invariant(C instanceof Value || C instanceof AbruptCompletion);\n\n    // 9. Return Completion(UpdateEmpty(C, undefined)).\n    let res = UpdateEmpty(realm, C, realm.intrinsics.undefined);\n    if (res instanceof AbruptCompletion) throw res;\n    invariant(res instanceof Value);\n    return res;\n  } finally {\n    // 8. Set the running execution context's LexicalEnvironment to oldEnv.\n    realm.getRunningContext().lexicalEnvironment = oldEnv;\n  }\n}\n"]}