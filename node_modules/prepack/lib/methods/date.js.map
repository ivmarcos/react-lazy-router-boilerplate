{"version":3,"sources":["../../src/methods/date.js"],"names":["Day","TimeWithinDay","DaysInYear","DayFromYear","TimeFromYear","YearFromTime","InLeapYear","MonthFromTime","DayWithinYear","DateFromTime","WeekDay","DaylightSavingTA","LocalTime","UTC","HourFromTime","MinFromTime","SecFromTime","msFromTime","MakeTime","MakeDay","MakeDate","TimeClip","thisTimeValue","ToDateString","SecondsPerMinute","MinutesPerHour","HoursPerDay","msPerSecond","msPerMinute","msPerHour","msPerDay","LocalTZA","Date","getTimezoneOffset","realm","t","Math","floor","y","Error","t2","daysInYear","step","year","d","next","throwIfNotConcreteNumber","value","hour","min","sec","ms","isFinite","NaN","h","m","s","milli","month","date","dt","ym","mn","abs","yearDelta","baseDay","day","time","intrinsics","clippedTime","Object","is","$DateValue","undefined","createErrorThrowCompletion","TypeError","tv","isNaN","toString"],"mappings":"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","file":"date.js","sourcesContent":["/**\n * Copyright (c) 2017-present, Facebook, Inc.\n * All rights reserved.\n *\n * This source code is licensed under the BSD-style license found in the\n * LICENSE file in the root directory of this source tree. An additional grant\n * of patent rights can be found in the PATENTS file in the same directory.\n */\n\n/* @flow */\n\nimport { NumberValue, Value, ObjectValue } from \"../values/index.js\";\nimport type { Realm } from \"../realm.js\";\nimport { ToInteger } from \"./to.js\";\nimport invariant from \"../invariant.js\";\n\n// Constants\nexport const SecondsPerMinute = 60;\nexport const MinutesPerHour   = 60;\nexport const HoursPerDay      = 24;\nexport const msPerSecond      = 1000;\nexport const msPerMinute      = msPerSecond * SecondsPerMinute;\nexport const msPerHour        = msPerMinute * MinutesPerHour;\nexport const msPerDay         = msPerHour * HoursPerDay;\n\nlet LocalTZA = -(new Date(0)).getTimezoneOffset() * msPerMinute;\n\n// ECMA262 20.3.1.2\nexport function Day(realm: Realm, t: number): number {\n  return Math.floor(t / msPerDay);\n}\n\n// ECMA262 20.3.1.2\nexport function TimeWithinDay(realm: Realm, t: number): number {\n  return t % msPerDay;\n}\n\n// ECMA262 20.3.1.3\nexport function DaysInYear(realm: Realm, y: number): 365 | 366 {\n  if ((y % 4) !== 0) return 365;\n  if ((y % 4) === 0 && (y % 100) !== 0) return 366;\n  if ((y % 100) === 0 && (y % 400) !== 0) return 365;\n  if ((y % 400) === 0) return 366;\n\n  throw new Error(\"Invalid condition\");\n}\n\n// ECMA262 20.3.1.3\nexport function DayFromYear(realm: Realm, y: number): number {\n  return  365 * (y - 1970) + Math.floor((y - 1969) / 4) - Math.floor((y - 1901) / 100) + Math.floor((y - 1601) / 400);\n}\n\n// ECMA262 20.3.1.3\nexport function TimeFromYear(realm: Realm, y: number): number {\n  return msPerDay * DayFromYear(realm, y);\n}\n\n// ECMA262 20.3.1.3\nexport function YearFromTime(realm: Realm, t: number): number {\n  let y = Math.floor(t / (msPerDay * 365.2425)) + 1970;\n  let t2 = TimeFromYear(realm, y);\n\n  if (t2 > t) {\n    y--;\n  } else {\n    if (t2 + msPerDay * DaysInYear(realm, y) <= t) {\n      y++;\n    }\n  }\n  return y;\n}\n\n// ECMA262 20.3.1.3\nexport function InLeapYear(realm: Realm, t: number): number {\n  let daysInYear = DaysInYear(realm, YearFromTime(realm, t));\n  if (daysInYear === 365) return 0;\n  if (daysInYear === 366) return 1;\n  throw new Error(\"invalid condition\");\n}\n\n// ECMA262 20.3.1.4\nexport function MonthFromTime(realm: Realm, t: number): number {\n  let step: ?number;\n  let year = YearFromTime(realm, t);\n  let d = DayWithinYear(realm, t, year);\n\n  if (d < (step = 31)) return 0;\n\n  step += (InLeapYear(realm, t) ? 29 : 28);\n  if (d < step) return 1;\n  if (d < (step += 31)) return 2;\n  if (d < (step += 30)) return 3;\n  if (d < (step += 31)) return 4;\n  if (d < (step += 30)) return 5;\n  if (d < (step += 31)) return 6;\n  if (d < (step += 31)) return 7;\n  if (d < (step += 30)) return 8;\n  if (d < (step += 31)) return 9;\n  if (d < (step += 30)) return 10;\n  return 11;\n}\n\n// ECMA262 20.3.1.4\nexport function DayWithinYear(realm: Realm, t: number): number {\n  return Day(realm, t) - DayFromYear(realm, YearFromTime(realm, t));\n}\n\n// ECMA262 20.3.1.5\nexport function DateFromTime(realm: Realm, t: number): number {\n  let step: ?number;\n  let next: ?number;\n  let year = YearFromTime(realm, t);\n  let d = DayWithinYear(realm, t, year);\n\n  if (d <= (next = 30)) return d + 1;\n\n  step = next;\n  next += (InLeapYear(realm, t) ? 29 : 28);\n  if (d <= next) return d - step;\n\n  step = next;\n  if (d <= (next += 31)) return d - step;\n\n  step = next;\n  if (d <= (next += 30)) return d - step;\n\n  step = next;\n  if (d <= (next += 31)) return d - step;\n\n  step = next;\n  if (d <= (next += 30)) return d - step;\n\n  step = next;\n  if (d <= (next += 31)) return d - step;\n\n  step = next;\n  if (d <= (next += 31)) return d - step;\n\n  step = next;\n  if (d <= (next += 30)) return d - step;\n\n  step = next;\n  if (d <= (next += 31)) return d - step;\n\n  step = next;\n  if (d <= (next += 30)) return d - step;\n\n  step = next;\n  return d - step;\n}\n\n// ECMA262 20.3.1.6\nexport function WeekDay(realm: Realm, t: number): number {\n  return (Day(realm, t) + 4) % 7;\n}\n\n// ECMA262 20.3.1.7\nexport function DaylightSavingTA(realm: Realm, t: number): number {\n  // TODO: Implement DaylightSavingTA\n  return 0;\n}\n\n// ECMA262 20.3.1.9\nexport function LocalTime(realm: Realm, t: number): number {\n  // 1. Return t + LocalTZA + DaylightSavingTA(t).\n  return t + LocalTZA + DaylightSavingTA(realm, t);\n}\n\n// ECMA262 20.3.1.10\nexport function UTC(realm: Realm, t: number | Value): NumberValue {\n  if (t instanceof Value) t = t.throwIfNotConcreteNumber().value;\n\n  // 1. Return t - LocalTZA - DaylightSavingTA(t - LocalTZA).\n  return new NumberValue(realm, t - LocalTZA - DaylightSavingTA(realm, t - LocalTZA));\n}\n\n// ECMA262 20.3.1.11\nexport function HourFromTime(realm: Realm, t: number): number {\n  return Math.floor(t / msPerHour) % HoursPerDay;\n}\n\n// ECMA262 20.3.1.11\nexport function MinFromTime(realm: Realm, t: number): number {\n  return Math.floor(t / msPerMinute) % MinutesPerHour;\n}\n\n// ECMA262 20.3.1.11\nexport function SecFromTime(realm: Realm, t: number): number {\n  return Math.floor(t / msPerSecond) % SecondsPerMinute;\n}\n\n// ECMA262 20.3.1.11\nexport function msFromTime(realm: Realm, t: number): number {\n  return t % msPerSecond;\n}\n\n// ECMA262 20.3.1.12\nexport function MakeTime(realm: Realm, hour: number, min: number, sec: number, ms: number): number {\n  // 1. If hour is not finite or min is not finite or sec is not finite or ms is not finite, return NaN.\n  if (!isFinite(hour) || !isFinite(min) || !isFinite(sec) || !isFinite(ms)) return NaN;\n\n  // 2. Let h be ToInteger(hour).\n  let h = ToInteger(realm, new NumberValue(realm, hour));\n\n  // 3. Let m be ToInteger(min).\n  let m = ToInteger(realm, new NumberValue(realm, min));\n\n  // 4. Let s be ToInteger(sec).\n  let s = ToInteger(realm, new NumberValue(realm, sec));\n\n  // 5. Let milli be ToInteger(ms).\n  let milli = ToInteger(realm, new NumberValue(realm, ms));\n\n  // 6. Let t be h * msPerHour + m * msPerMinute + s * msPerSecond + milli, performing the arithmetic\n  //    according to IEEE 754-2008 rules (that is, as if using the ECMAScript operators * and +).\n  let t = h * msPerHour + m * msPerMinute + s * msPerSecond + milli;\n\n  // 7. Return t.\n  return t;\n}\n\n// ECMA262 20.3.1.13\nexport function MakeDay(realm: Realm, year: number, month: number, date: number): number {\n  // 1. If year is not finite or month is not finite or date is not finite, return NaN.\n  if (!isFinite(year) || !isFinite(month) || !isFinite(date)) return NaN;\n\n  // 2. Let y be ToInteger(year).\n  let y = ToInteger(realm, new NumberValue(realm, year));\n\n  // 3. Let m be ToInteger(month).\n  let m = ToInteger(realm, new NumberValue(realm, month));\n\n  // 4. Let dt be ToInteger(date).\n  let dt = ToInteger(realm, new NumberValue(realm, date));\n\n  // 5. Let ym be y + floor(m / 12).\n  let ym = y + Math.floor(m / 12);\n\n  // 6. Let mn be m modulo 12.\n  let mn = m < 0 ? (m % 12 + 12) : (m % 12);\n\n  // 7. Find a value t such that YearFromTime(t) is ym and MonthFromTime(t) is mn and DateFromTime(t) is 1;\n  //    but if this is not possible (because some argument is out of range), return NaN.\n  //    Inspired by the V8 implementation.\n  if (Math.abs(ym) >= 1000000.0 || Math.abs(mn) >= 1000000.0) {\n    return NaN;\n  }\n  const yearDelta = 399999;\n  const baseDay = 365 * (1970 + yearDelta) +\n    Math.floor((1970 + yearDelta) / 4) - Math.floor((1970 + yearDelta) / 100) +\n    Math.floor((1970 + yearDelta) / 400);\n  let t =\n      365 * (ym + yearDelta) + Math.floor((ym + yearDelta) / 4) -\n      Math.floor((ym + yearDelta) / 100) + Math.floor((ym + yearDelta) / 400) -\n      baseDay;\n\n  if ((ym % 4 !== 0) || (ym % 100 === 0 && ym % 400 !== 0)) {\n    t += [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334][mn];\n  } else {\n    t += [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335][mn];\n  }\n\n  // 8. Return Day(t) + dt - 1.\n  return t + dt - 1;\n}\n\n// ECMA262 20.3.1.14\nexport function MakeDate(realm: Realm, day: number, time: number): number {\n  // 1. If day is not finite or time is not finite, return NaN.\n  if (!isFinite(day) || !isFinite(time)) return NaN;\n\n  // 2. Return day × msPerDay + time.\n  return day * msPerDay + time;\n}\n\n// ECMA262 20.3.1.15\nexport function TimeClip(realm: Realm, time: number | Value): NumberValue {\n  if (time instanceof Value) time = time.throwIfNotConcreteNumber().value;\n  // 1. If time is not finite, return NaN.\n  if (!isFinite(time)) return realm.intrinsics.NaN;\n\n  // 2. If abs(time) > 8.64 × 10^15, return NaN.\n  if (Math.abs(time) > 8640000000000000) {\n    return realm.intrinsics.NaN;\n  }\n\n  // 3. Let clippedTime be ToInteger(time).\n  let clippedTime = ToInteger(realm, new NumberValue(realm, time));\n\n  // 4. If clippedTime is -0, let clippedTime be +0.\n  if (Object.is(clippedTime, -0)) clippedTime = +0;\n\n  // 5. Return clippedTime.\n  return new NumberValue(realm, clippedTime);\n}\n\n// ECMA262 20.3.4\nexport function thisTimeValue(realm: Realm, value: Value): Value {\n  // 1. If Type(value) is Object and value has a [[DateValue]] internal slot, then\n  if (value instanceof ObjectValue && value.$DateValue !== undefined) {\n    // a. Return the value of value's [[DateValue]] internal slot.\n    return value.$DateValue;\n  }\n\n  // 2. Throw a TypeError exception.\n  throw realm.createErrorThrowCompletion(realm.intrinsics.TypeError);\n}\n\n// ECMA262 20.3.4.41.1\nexport function ToDateString(realm: Realm, tv: number): string {\n  // 1. Assert: Type(tv) is Number.\n  invariant(typeof tv === \"number\", \"expected tv to be a number\");\n\n  // 2. If tv is NaN, return \"Invalid Date\".\n  if (isNaN(tv)) return \"Invalid Date\";\n\n  // 3. Return an implementation-dependent String value that represents tv as a date and time in the current\n  //    time zone using a convenient, human-readable form.\n  return new Date(tv).toString();\n}\n"]}